<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Javascript weblog</title>
<link rel="stylesheet" href="../default.css"/>
<link rel="stylesheet" href="../xsl/webLog.css"/>
<script language="javascript" src="../js/menu.js">/*fix*/</script>
<script language="javascript" src="mindex.js">/*fix*/</script>
<script language="javascript" src="../js/colorSyntaxJS.js">/*fix*/</script>
<script type="text/javascript" src="http://www.haloscan.com/load/zanstra"></script>
<script language="javascript" type="text/javascript">
window.onload=function()
{
	hiLiteJS("JS");
	hiLiteJS("JSnr",true);
}
        </script>
</head>
<body>
<table cellpadding="0" border="0"><tr><td width="100">
<div style="text-align: center">
<img src="../img/jsLogo.png"/>
</div>
<div style="font-family: Tahoma, sans-serif; font-size: 8pt; text-align: center">
            log.js</div>
</td><td style="width: 5px"> </td><td>
<h1>Javascript weblog</h1>
</td></tr><tr><td>
<script language="javascript">writeMenu();</script>
</td><td/><td style="border-left: 1px solid black; padding-left: 7px">
<div class="weblog">
<h2 class="title">
<a title="Link for future reference to this entry" name="ScrollIntoView" href="#ScrollIntoView">ScrollIntoView</a>
<span class="date">
        (15 October 2005)
      </span>
</h2>
<p>
        There are a number of problem's with IE's <a href="http://msdn.microsoft.com/library/default.asp?url=/workshop/author/dhtml/reference/methods/scrollintoview.asp">scrollIntoView</a> method. Not all browsers support it (Safari 2.0 doesn't support it, but it's already implemented in <a href="http://webkit.opendarwin.org">WebKit</a> in <a href="http://www.opendarwin.org/pipermail/webkit-changes/2005-July/000379.html">July 2005</a>. The second problem is the binarity of all: you see it or you don't. I would like to apply a margin: if the element is for example 100 pixels or less from the border, scroll it.
    </p>
<p class="&#xA;      There's no support for vertical scrolling, because I don't need it (a note here: vertical scrolling is bad. You don't need it and it is not good. Don't use it, don't argue). Another issue: no support for scrolling of overflow elements yet.&#xA;    ">
      There's no support for vertical scrolling, because I don't need it (a note here: vertical scrolling is <strong>bad</strong>. You don't need it and it is not good. Don't use it, don't argue). Another issue: no support for scrolling of <code>overflow</code> elements yet.
    </p>
<p>
<span class="updated">Updated:</span> The code has been tested and is working in: Safari 2.0, IE/Win 6.0, IE/Mac 5, Opera/Mac 8, FireFox/Mac 1.5 beta 2 and FireFox/Win 1.0.7 (all both quirks and compliant-mode).
    </p>
<p>
<span class="updated">Updated:</span> I used this function for my gmail <a href="../dzLib/chknav.htm">checkbox keyboard navigator</a> clone.
    </p>
<pre class="JS">
function InView(element,margin) {
  if(!margin) margin=0;
  var Top=GetTop(element), ScrollTop=GetScrollTop();
  return !(Top&lt;ScrollTop+margin||
    Top&gt;ScrollTop+GetWindowHeight()-element.offsetHeight-margin);
}
function ScrollIntoView(element,bAlignTop,margin) {
  if(!margin) margin=0;
  var posY=GetTop(element);
  if(bAlignTop) posY-=margin;
  else posY+=element.offsetHeight+margin-GetWindowHeight();
  window.scrollTo(0, posY);
}
function GetWindowHeight() {
  return window.innerHeight||
    document.documentElement&&document.documentElement.clientHeight||
    document.body.clientHeight||0;
}
function GetScrollTop() {
  return window.pageYOffset||
    document.documentElement&&document.documentElement.scrollTop||
    document.body.scrollTop||0;
}
function GetTop(element) {
  var pos=0;
  do pos+=element.offsetTop
  while(element=element.offsetParent);
  return pos;
}</pre>
<div>
<a target="_self" href="javascript:HaloScan('ScrollIntoView');"><script type="text/javascript">postCount('ScrollIntoView');</script></a> 
        | 
        <a target="_self" href="javascript:HaloScanTB('ScrollIntoView');"><script type="text/javascript">postCountTB('ScrollIntoView'); </script></a>
</div>
<div class="spacer"> </div>
<h2 class="title">
<a title="Link for future reference to this entry" name="funcReplace" href="#funcReplace">Using functions with String.replace</a>
<span class="date">
        (29 May 2005)
      </span>
</h2>
<p>
        Introduced in Javascript 1.3 (NN 4.06+, including FF) and JScript 5.5 (IE5.5+/Win).
        Not in: Safari 1.3.
        NOTE: still doesn't work in IE5.2/Mac (RegExp.$0), no submatches?
      </p>
<p>You can test the code: <span class="run" title="Click to run the code" onclick="TestPcFormat()">TestPcFormat()</span>.</p>
<pre class="JS">
var PcFormat=/^\d{4} ?[a-z]{2}$/i;
function FormatPc(match) {
  return match.replace(/\s+/,'').toUpperCase();
}
FormatPc.toString=function() {
  return FormatPc(RegExp.$0);
}
//--| Test function |---------------------------------------
function TestPcFormat() {
  var s=prompt("Please supply a Dutch postcode","9711 pl");
  if(s) {
    if(PcFormat.test(s)) {
      s=s.replace(PcFormat,FormatPc);
      alert("The postcode is: "+s);
    }
    else { 
      alert("Wrong format. Use 4 digits and two letters, \
optionally seperated by a space");
    }
  }
}</pre>
<script language="javascript">
var PcFormat=/^\d{4} ?[a-z]{2}$/i;
function FormatPc(match) {
  return match.replace(/\s+/,'').toUpperCase();
}
FormatPc.toString=function() {
  return FormatPc(RegExp.$0);
}
//--| Test function |---------------------------------------
function TestPcFormat() {
  var s=prompt("Please supply a Dutch postcode","9711 pl");
  if(s) {
    if(PcFormat.test(s)) {
      s=s.replace(PcFormat,FormatPc);
      alert("The postcode is: "+s);
    }
    else { 
      alert("Wrong format. Use 4 digits and two letters, \
optionally seperated by a space");
    }
  }
}</script>
<div>
<a target="_self" href="javascript:HaloScan('funcReplace');"><script type="text/javascript">postCount('funcReplace');</script></a> 
        | 
        <a target="_self" href="javascript:HaloScanTB('funcReplace');"><script type="text/javascript">postCountTB('funcReplace'); </script></a>
</div>
<div class="spacer"> </div>
<h2 class="title">
<a title="Link for future reference to this entry" name="weekNr" href="#weekNr">Week number</a>
<span class="date">
        (15 April 2005)
      </span>
</h2>
<p>
        Grouping events per week can be very handy, so I wrote a javascript method to do so. I followed the <a href="http://www.iso.org/iso/en/prods-services/popstds/datesandtime.html">ISO-8601</a> standard (<a href="http://en.wikipedia.org/wiki/Week">see</a>
<a href="http://www.cl.cam.ac.uk/~mgk25/iso-time.html">more</a>
<a href="http://www.mcs.vuw.ac.nz/technical/software/SGML/doc/iso8601/ISO8601.html">here</a>). Test todays week number: <span class="run" title="Click to run the code" onclick="alert(new Date().getWeekNr()+1)">alert(new Date().getWeekNr()+1)</span>.
      </p>
<pre class="JS">
//Like valueOf(), only resolution in days, not ms.
Date.prototype.valueInDays=function() {
  return parseInt(new Date(this.getFullYear(),
    this.getMonth(),
    this.getDate()).valueOf()/(24*60*60*1000));
}
//Day of week, zero-based (monday=0, sunday=6)
Date.prototype.getWeekDay=function() {
  return this.getDay()==0 ? 6 : this.getDay()-1;
}
//Week number according to ISO-8601, zero-based (1 is 2nd week).
Date.prototype.getWeekNr=function() {
  var x = new Date(this.getFullYear(),0,1); 
  x.setDate([0,0,0,0,3,2,1][x.getWeekDay()]+x.getDate());
  if(this.valueInDays() < x.valueInDays()) 
    return new Date(this.getFullYear()-1,12-1,31).getWeekNr();
  else 
    return parseInt((this.valueInDays()-x.valueInDays()+x.getWeekDay())/7,10);
}</pre>
<script language="javascript">
//Like valueOf(), only resolution in days, not ms.
Date.prototype.valueInDays=function() {
  return parseInt(new Date(this.getFullYear(),
    this.getMonth(),
    this.getDate()).valueOf()/(24*60*60*1000));
}
//Day of week, zero-based (monday=0, sunday=6)
Date.prototype.getWeekDay=function() {
  return this.getDay()==0 ? 6 : this.getDay()-1;
}
//Week number according to ISO-8601, zero-based (1 is 2nd week).
Date.prototype.getWeekNr=function() {
  var x = new Date(this.getFullYear(),0,1); 
  x.setDate([0,0,0,0,3,2,1][x.getWeekDay()]+x.getDate());
  if(this.valueInDays() < x.valueInDays()) 
    return new Date(this.getFullYear()-1,12-1,31).getWeekNr();
  else 
    return parseInt((this.valueInDays()-x.valueInDays()+x.getWeekDay())/7,10);
}</script>
<div>
<a target="_self" href="javascript:HaloScan('weekNr');"><script type="text/javascript">postCount('weekNr');</script></a> 
        | 
        <a target="_self" href="javascript:HaloScanTB('weekNr');"><script type="text/javascript">postCountTB('weekNr'); </script></a>
</div>
<div class="spacer"> </div>
<h2 class="title">
<a title="Link for future reference to this entry" name="Flushed2004" href="#Flushed2004">Archived</a>
<span class="date">
        (22 October 2005)
      </span>
</h2>
<p>The topics from 2004 and older have been <a href="jsLog-2004.htm">archived here</a>.</p>
<div class="spacer"> </div>
</div>
<div class="footer">
<a href="mailto:zanstra@xs4all.nl?subject=webLog" title="Stuur een email">Doeke Zanstra</a>, 2002-2005. 
          The xml-version can be downloaded <a href="jsLog.xml">as well</a>.
				 </div>
</td></tr></table></body>
</html>
