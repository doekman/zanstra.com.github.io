var oPreferences={sCallDefIdentifier:'call',bArrayDefault:false,sListSeperator:','};function Interface(){this.processParam=Interface_processParam;this.processUnTyped=Interface_processUnTyped;this.processTyped=Interface_processTyped;this.err=Interface_err;this.oArg=new Object();this.aErr=new Array();this.bValid=true;this.oCallDefs=new Object();this.aCallDefs=new Array();this.bTyped=arguments.length>=1;for(var i=0;i<arguments.length;i++){this.oCallDefs[arguments[i].sName]=this.aCallDefs[this.aCallDefs.length]=arguments[i];};this.processParam(location.search);if(this.aCallDefs.length==0){this.processUnTyped();}else{this.processTyped();};delete this.aParam;return this;};function Interface_processParam(s){if(s.indexOf('=')!=-1){this.aParam=s.substr(1).split('&');for(var i=0;i<this.aParam.length;i++){var t=this.aParam[i];var j=t.indexOf('=');var a=new Array();a[0]=unescape(t.substring(0,j));a[1]=unescape(t.substr(j+1));this.aParam[i]=a;}}else{this.aParam=new Array();}};function Interface_processUnTyped(){for(var i=0;i<this.aParam.length;i++){var name=this.aParam[i][0];var value=this.aParam[i][1];if(typeof this.oArg[name]=='undefined'){if(oPreferences.bArrayDefault){this.oArg[name]=[value];}else{this.oArg[name]=value;}}else{if(oPreferences.bArrayDefault){this.oArg[name][this.oArg[name].length]=value;}else{this.oArg[name]+=oPreferences.sListSeperator+value;}}}};function Interface_processTyped(){var oCallDef;if(this.aCallDefs.length==1){oCallDef=this.aCallDefs[0];}else{for(var i=0;i<this.aParam.length;i++){if(this.aParam[i][0]==oPreferences.sCallDefIdentifier){var sCallDefID=this.aParam[i][1];if(this.oCallDefs[sCallDefID]==null){this.err('4,fatal,Unknown call-definition identifier found: "'+this.aParam[i].join('=')+'"');return;};oCallDef=this.oCallDefs[sCallDefID];break;}};if(oCallDef==null){oCallDef=this.aCallDefs[0];}};for(var i=0;i<this.aParam.length;i++){var name=this.aParam[i][0];var value=this.aParam[i][1];if(name==oPreferences.sCallDefIdentifier)continue;if(oCallDef.oArgDefs[name]==null){this.err('1,Error,Argument "'+name+'" is not defined within CallDefinition "'+oCallDef.sName+'"');continue;}else{var oArgDef=oCallDef.oArgDefs[name];switch(oArgDef.sType){case 'string':break;case 'int':value=parseInt(value,10);if(isNaN(value))value=null;break;case 'float':value=parseFloat(value);if(isNaN(value))value=null;break;case 'boolean':if(value=='true')value=true;else if(value=='false')value=false;else value=null;break;case 'date':value=str2nlDate(value);break;case 'enum':var nEnumPos;for(nEnumPos=0;nEnumPos<oArgDef.aEnumValues.length;nEnumPos++){if(value==oArgDef.aEnumValues[nEnumPos]){break;}};if(nEnumPos>=oArgDef.aEnumValues.length){value=null;};break;default:value=null;break;};if(value==null){this.err('2,Type conversion error: Field "'+name+'" of type "'+oArgDef.sType+'" could not be converted (may be not implemented yet)');}else{if(oArgDef.bIsArray){if(this.oArg[name]==null)this.oArg[name]=[value];else this.oArg[name][this.oArg[name].length]=value;}else{if(this.oArg[name]==null)this.oArg[name]=value;else this.err('3,Multiple entries of field "'+name+'" (but it\'s not defined as an array).');}}}}for(var i;i<oCallDef.aArgDefs.length;i++){var arg=oCallDef.aArgDefs[i];if(arg.bRequired){if(this.oArg[arg.sName]==null)this.err('5,error,Field "'+arg.sName+'" is required, but is not supplied.');}else{if(arg.vDefault!=null){if(arg.bIsArray)this.oArg[arg.sName]=[arg.vDefault];else this.oArg[arg.sName]=arg.vDefault;}}}}function obj2str(o,r){var s='';for(var i in o){if(!r||r.test(i)){s+=i+': '+o[i]+'\n';}}return s;}function Interface_err(s){this.aErr[this.aErr.length]=s;this.bValid=false;}function CallDefinition(sName){this.sName=sName;this.oArgDefs=new Object();this.aArgDefs=new Array();this.addArgument=CallDefinition_addArgument;return this;}function CallDefinition_addArgument(sName,sType,bIsArray,bRequired,vDefault,aEnumValues){if(typeof sName=='string'){var arg=this.aArgDefs[this.aArgDefs.length]=this.oArgDefs[sName]=new Object();arg.sName=sName;arg.sType=sType;arg.bIsArray=bIsArray==null?false:bIsArray;arg.bRequired=bRequired==null?true:bRequired;if(vDefault!=null)arg.vDefault=vDefault;if(sType=='enum')arg.aEnumValues=aEnumValues;}else if(typeof sName=='object'){var o=sName;var arg=this.aArgDefs[this.aArgDefs.length]=this.oArgDefs[o.sName]=new Object();arg.sName=o.sName;arg.sType=o.sType;arg.bIsArray=o.bIsArray==null?false:o.bIsArray;arg.bRequired=o.bRequired==null?true:o.bRequired;if(o.vDefault!=null)arg.vDefault=o.vDefault;if(o.sType=='enum')arg.aEnumValues=o.aEnumValues;}};function str2nlDate(st){var s=String(st);var arrS=String(st).split("-");if(arrS.length!=3)return null;var y=parseInt(arrS[2],10);var m=parseInt(arrS[1],10);var d=parseInt(arrS[0],10);if(isNaN(y)||isNaN(m)||isNaN(d))return null;return new Date(y,m-1,d);}

